<!DOCTYPE html>
<html>
<head><title>Admin - Cognito IAS</title></head>
<body style="font-family: Arial; padding: 30px; background: #f0f2f5;">
    <h1>Admin Dashboard (Logic Tested)</h1>

    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3>Add Category</h3>
        <form action="/admin/add_category" method="POST">
            <input type="text" name="cat_name" placeholder="Category Name" required>
            <button type="submit">Save</button>
        </form>
    </div>
    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px dashed #1976d2;">
    <h4 style="margin-top:0;">âœ¨ AI Magic Generator</h4>
    <input type="text" id="ai-topic" placeholder="Topic likhein (e.g. Fundamental Rights)" style="width: 60%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
    <button type="button" onclick="askAI()" id="ai-btn" style="padding: 8px 15px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer;">Generate Question</button>
</div>
    <div style="background: white; padding: 20px; border-radius: 8px; border-left: 5px solid green;">
        <h3>Add New MCQ (Bilingual)</h3>
        <form action="/admin/save_mcq" method="POST">
            <p>English Question:</p>
            <textarea name="q_en" style="width: 100%;" rows="3"></textarea>
            
            <p>Hindi Question (Optional):</p>
            <textarea name="q_hi" style="width: 100%;" rows="3"></textarea>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <input type="text" name="oa" placeholder="Option A" required>
                <input type="text" name="ob" placeholder="Option B" required>
                <input type="text" name="oc" placeholder="Option C" required>
                <input type="text" name="od" placeholder="Option D" required>
            </div>

            <div style="margin-top: 15px;">
                <label>Correct Answer:</label>
                <select name="ans">
                    <option value="A">A</option><option value="B">B</option>
                    <option value="C">C</option><option value="D">D</option>
                </select>
            </div>

            <p>Explanation:</p>
            <textarea name="exp" style="width: 100%;" rows="2"></textarea>

            <button type="submit" style="background: green; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-top: 15px;">
                Save MCQ to Database
            </button>
        </form>
    </div>
    <script>
function askAI() {
    let topic = document.getElementById('ai-topic').value;
    let btn = document.getElementById('ai-btn');
    if(!topic) return alert("Pehle topic toh likhiye!");
    
    btn.innerText = "AI Soch raha hai...";
    btn.disabled = true;
    
    fetch('/admin/generate_ai', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({topic: topic})
    })
    .then(res => res.json())
    .then(data => {
        console.log("AI Raw Data:", data);

        // LOGIC: Agar keys alag naam se aayein, toh bhi ye dhoond lega
        const questionEn = data.q_en || data.question_en || data.question || "";
        const questionHi = data.q_hi || data.question_hi || "";
        const optionA = data.oa || data.option_a || data.a || "";
        const optionB = data.ob || data.option_b || data.b || "";
        const optionC = data.oc || data.option_c || data.c || "";
        const optionD = data.od || data.option_d || data.d || "";
        const correctAns = data.ans || data.correct || data.answer || "A";
        const explain = data.exp || data.explanation || "";

        // Form ke dabbo mein sahi data bharna
        document.getElementsByName('q_en')[0].value = questionEn;
        document.getElementsByName('q_hi')[0].value = questionHi;
        document.getElementsByName('oa')[0].value = optionA;
        document.getElementsByName('ob')[0].value = optionB;
        document.getElementsByName('oc')[0].value = optionC;
        document.getElementsByName('od')[0].value = optionD;
        document.getElementsByName('ans')[0].value = correctAns;
        document.getElementsByName('exp')[0].value = explain;
        
        btn.innerText = "Generate Question";
        btn.disabled = false;
    })
    .catch(err => {
        console.error("Error:", err);
        alert("Galti hui: " + err);
        btn.innerText = "Generate Question";
        btn.disabled = false;
    });
}
</script>
</body>
</html>
